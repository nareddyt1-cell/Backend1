<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pancreatic Proenzyme Sequence Analyzer</title>

<style>
body {
    font-family: Arial, sans-serif;
    max-width: 1100px;
    margin: auto;
}

textarea {
    width: 100%;
    height: 220px;
    font-family: monospace;
    white-space: pre-wrap;
    word-break: break-word;
}

button {
    margin-top: 12px;
    padding: 12px 20px;
    font-size: 16px;
    cursor: pointer;
}

.section {
    margin-top: 30px;
}

.bar-container {
    width: 100%;
    background: #eee;
    border-radius: 6px;
    margin-top: 6px;
}

.bar {
    height: 26px;
    border-radius: 6px;
    text-align: right;
    padding-right: 8px;
    color: white;
    font-weight: bold;
}

.normal {
    background: #2c7;
}

.damaged {
    background: #e44;
}
</style>
</head>

<body>

<h1>Pancreatic Proenzyme Sequence Analyzer</h1>
<small>A testing sofware to analyze a proenzyme's likelyhood functionality vs. a genetically damaged proenzyme.
    Place the Wild Type proenzyme amino-acid sequence in the first box, then place the damaged proenzyme amino-acid sequence in the second box.
    Note: the proenzyme's should be same specififc enzyme. Once the button under both boxes is clicked, the likelyhood functionality data will appear.</small>
<div class="section">
<h3>Normal (Reference) Sequence</h3>
<textarea id="normal"></textarea>
</div>

<div class="section">
<h3>Damaged Sequence</h3>
<textarea id="damaged"></textarea>
</div>

<button type="button" onclick="analyze()">Analyze Sequence</button>

<div class="section">
<h3>Identified Enzyme</h3>
<div id="enzyme">—</div>
</div>

<div class="section">
<h3>Functional Likelihood (%)</h3>

<label>Normal Enzyme</label>
<div class="bar-container">
    <div id="normalBar" class="bar normal" style="width:0%">0%</div>
</div>

<label>Damaged Enzyme</label>
<div class="bar-container">
    <div id="damagedBar" class="bar damaged" style="width:0%">0%</div>
</div>
</div>

<div class="section">
<h3>Mutation Details</h3>
<pre id="mutations">—</pre>
</div>

<div class="section">
<h3>Lost Biological Function</h3>
<div id="lost">—</div>
</div>

<script>
async function analyze() {
    console.log("Analyze button clicked");

    const normal = document.getElementById("normal").value.trim();
    const damaged = document.getElementById("damaged").value.trim();

    if (!normal || !damaged) {
        alert("Please paste both sequences.");
        return;
    }

    try {
        const response = await fetch("https://backend-688r.onrender.com/analyze", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                normal_sequence: normal,
                damaged_sequence: damaged
            })
        });

        const data = await response.json();

        document.getElementById("enzyme").textContent = data.identified_enzyme;
        document.getElementById("lost").textContent = data.lost_function;

        document.getElementById("normalBar").style.width = data.normal_percent + "%";
        document.getElementById("normalBar").textContent = data.normal_percent + "%";

        document.getElementById("damagedBar").style.width = data.damaged_percent + "%";
        document.getElementById("damagedBar").textContent = data.damaged_percent + "%";

        document.getElementById("mutations").textContent =
            data.mutations.map(
                m => `Position ${m.position}: ${m.from} → ${m.to}`
            ).join("\n") || "No mutations detected.";

    } catch (err) {
        console.error(err);
        alert("Backend connection failed.");
    }
}
</script>

</body>
</html>
